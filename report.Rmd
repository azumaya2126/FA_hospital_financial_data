---
title: "統計的方法論特殊研究（応用回帰分析）"
subtitle: "最終レポート　課題2"
date: "2023-08-11"
author: "経営学研究科博士課程前期課程1年　東 茉弥（学籍番号：234B008B）"
output:
  html_document:
    toc: TRUE
    toc_depth: 3
    toc_float: TRUE
    number_sections: TRUE
---



## はじめに

　卒業論文「病院の患者満足度と財務指標に関する研究 -独立行政法人国立病院機構における分析-」で扱った国立病院機構の患者満足度調査のデータを用いて分析を行う。
卒業論文では回帰分析と因子分析を行ったものの、当時は因子分析について何も分かっていなかったため、今回は改めて探索的因子分析を行う。



## 使用データ


- 国立病院機構所属の約140病院の患者満足度調査結果
- 平成16（2004）年度から平成20（2008）年度のまでの5年分

```{r include = FALSE}
#パッケージダウンロード
library(psych)
library(tidyverse)
library(knitr)
library(polycor)
library(GPArotation)

```


```{r}
#データ読み込み
data_in <- read.csv("ps_inpatient_NHO.csv")

#概要を見る
summary(data_in)
```

　患者満足度調査は全ての病院で同じ調査票が使われている。
患者満足度調査は、国立病院が独立行政法人化された平成16年度に開始され、現在でも続いている。
質問項目や対象患者の区分の変更は行われているが、今回使用する5年間は同じ質問票による調査結果である。


　調査は入院患者と外来患者で区分され、入院患者向けの質問項目を付録に掲載した。
入院患者向けの調査票は、19項目の質問にそれぞれ5つの小項目がついている形式である。今回の分析では19項目を使用する。


　調査の内容については、「多くの研究者の手により、長年研究・開発された内容・手法によるものであり、科学的根拠に基づき導き出された｢10の医療サービスクオリティ｣の要因毎に集計・分析され、更にその要因毎に各病院で検討・改善できる設問で構成されている（国立病院機構評価シート, p.1）」としている。
また、質問項目については「全体にネガティブな質問（ネガティブ・クエスチョン）とし、患者の満足度調査に対する心理的障壁を取り払い、本音を引き出しやすくすることにより、より一層調査精度の向上と客観性を追求する方法とした（国立病院機構評価シート, p.1）」とある。




## データクリーニング


### 統合・廃止された病院の削除

以下の表の通り、統合・廃止された年以降の行を削除する。

|year|hospital_no|hospital_name|
|:--:|:---:|---|
|2004|52 |西甲府病院|
|2004|97 |奈良病院|
|2004|131|筑後病院|
|2005|61 |金沢若松病院|
|2005|65 |岐阜病院|
|2005|74 |豊橋病院|
|2005|103|鳥取病院|
|2005|112|原病院|
|2008|43|南横浜病院|
|2008|55|中信松本病院|


```{r}

data_in <- data_in |> filter(!(hospital_no == 52 & year %in% c(2004:2008)))
data_in <- data_in |> filter(!(hospital_no == 97 & year %in% c(2004:2008)))
data_in <- data_in |> filter(!(hospital_no == 131 & year %in% c(2004:2008)))
data_in <- data_in |> filter(!(hospital_no == 61 & year %in% c(2005:2008)))
data_in <- data_in |> filter(!(hospital_no == 75 & year %in% c(2005:2008)))
data_in <- data_in |> filter(!(hospital_no == 74 & year %in% c(2005:2008)))
data_in <- data_in |> filter(!(hospital_no == 103 & year %in% c(2005:2008)))
data_in <- data_in |> filter(!(hospital_no == 112 & year %in% c(2005:2008)))
data_in <- data_in |> filter(!(hospital_no == 43 & year %in% c(2008)))
data_in <- data_in |> filter(!(hospital_no == 55 & year %in% c(2008)))

```



### 欠損値の処理

```{r}
#列名を作っておく
cols <- paste0("X", 1:19)

#改めてsummaryを見てみる
#項目X1からX19のみ
data_in[, cols] |> summary()


```
どの項目もNAが20前後存在するが、特にX10とX13のNAの数が多い。X10は手術、X13はリハビリの満足度を問う項目。
NAに項目ごとの偏りが一部あることが分かる。

次に、NAの発生に年ごとの偏りがないかを見てみる。


```{r}

#年ごとの欠損値の数
#X1
tapply(is.na(data_in$X1), data_in$year, sum)
#X10
tapply(is.na(data_in$X10), data_in$year, sum)
#X13
tapply(is.na(data_in$X13), data_in$year, sum)


```
X13のみ明らかに2004年にNAが集中しているが、他の項目は年に偏る傾向は見られない。
今回は、年に関わらず項目の共通因子を探りたいため、NAを含む行を削除することにする。


```{r}

#X1～X19のデータを作成
data <- data_in[, cols]

#NAを削除
data <- na.omit(data)

#改めて概要を見る
summary(data)

#データ数
nrow(data)


```
19項目498観察で分析を行っていく。



## 項目分析

異常な項目がないかを確認する。

### 天井効果・床効果の確認

平均±標準偏差が取りうる値の範囲（1～6）を超えているかを確認する。

```{r}

#平均+標準偏差
apply(data, 2, mean)　+ apply(data, 2, sd)

#平均-標準偏差
apply(data, 2, mean) - apply(data, 2, sd)

```
今回は天井効果・床効果は観察されない。


### I-T相関

```{r}
#合計点を追加する
data[, "X_sum"] <- apply(data, 1, sum)

#ポリシリアル相関
apply(data[, cols], 2, polyserial, data$X_sum)

```
I-T相関は十分に高い。


### クロンバックのα係数

```{r}
psych::alpha(data[, cols])

#psychを指定しないとggplot2のalpha関数と思われてエラーになる

```
raw_alphaの値が0.96となっており、ある程度の信頼性は確保されているといえる。


## 探索的因子分析

### 因子分析の前に

KMOを用いて、独自因子に起因する相関があるかを確認する。

```{r}

KMO(data[, cols])

```
Overall MSAが0.96であることから、少なくとも共通因子が存在すると判断できる。


### 因子数の決定


因子数を決める。まずはカイザー基準を確認するためにスクリープロットを用いる。

```{r}

#スクリープロット
scree(data[, cols])

```

カイザー基準では2因子が提示される。次に、平行分析を用いて確認する。

```{r}

#平行分析
fa.parallel(data[, cols], fa = "fa")

```

平行分析では4因子が提示される。

```{r}

#VSS
VSS(data[,cols])

```
MAP基準では2因子、BIC基準では5因子が提示される。
今回扱っている19項目は、上位項目として5項目（1.入院時、2.入院中の診療、3.入院中の検査・手術・リハビリテーション・その他治療、4.入院中の環境、5.退院）が存在している。
BIC基準が提示する因子数も妥当と考えられる。


### 2因子での因子分析

続いて、2因子での因子分析を行う。



```{r}
#2因子
res_fa2 <- fa(data[, cols], nfactors = 2)
res_fa2 |> print(sort = TRUE)
```


因子負荷量のcomは1に近く、単純構造に近いといえる。

また、累積寄与率は0.70となっており、2因子で分散のうち約70%が説明できていることになる。





```{r}

#簡易的なグラフィカルモデル
fa.diagram(res_fa2, cut = 0.3)

```

```{r}
#因子負荷量のプロット
fa.plot(res_fa2)
```

図の通り、2軸にそれぞれ分かれており、解釈可能性は高い。試しに最尤法での推定を行ってみる。


```{r}
#最尤法を用いた場合
res_fa2 <- fa(data[, cols], nfactors = 2, fm = "ml")
res_fa2 |> print(sort = TRUE)
```
fa()のデフォルトである最小二乗法と大きく変わらない。

続いて、2因子の解釈を行う。因子負荷の順に項目を並べ替えてみると以下の通りになる。（質問文は簡略化した。）



|項目番号|内容（MR1）|
|:---:|---------|
|4|医師の態度や言葉づかい|
|8| 医療スタッフのチームワーク|
|5| 医師の技術や知識|
|11| 治療・処置|
|6| 看護師の態度・言葉づかい|
|1| 入院前の説明|
|12| 点滴、注射、薬|
|9| 検査|
|7| 日常生活の介助|
|2| 入院の手続き|
|10| 手術|
|19| 退院の説明|
|13| リハビリテーション|
|3| 入院生活の説明|


|項目番号|内容（MR2）|
|:---:|---------|
|14| 病院のトイレや浴室|
|16| 病室内の環境|
|18| 病院のその他の設備や環境|
|15| 病院の廊下や階段、エレベータ|
|17| 院中の食事|


上記の通り、第2因子は環境設備に関する項目であることが分かる。第1因子はそれ以外、というまとめ方になってしまうので、因子数を変えて再度分析してみる。




### 因子数を変えてみる

BIC基準で提示され、質問票の分類でもある5因子で因子分析を行う。

```{r}
#5因子
res_fa5 <- fa(data[, cols], nfactors = 5)
res_fa5 |> print(sort = TRUE)
```

累積寄与率を見ると2因子のときよりも上昇して0.77となっている。しかし、因子数が増えたことによる上昇とも考えられる。
また、comには1から遠い値が見られ、単純構造から離れている可能性がある。

念のため5つの項目を分類して、解釈可能性を考える。

```{r}
#簡易的なグラフィカルモデル
fa.diagram(res_fa5, cut = 0.3)

```

|項目番号|内容|
|:---:|---------|
| |（MR1） |
|7| 日常生活の介助|
|8| 医療スタッフのチームワーク|
|6| 看護師の態度・言葉づかい|
|9| 検査|
|3| 入院生活の説明|
| |（MR2） |
|14| 病院のトイレや浴室|
|16| 病室内の環境|
|18| 病院のその他の設備や環境|
|15| 病院の廊下や階段、エレベータ|
|17| 院中の食事|
| |（MR3） |
|11| 治療・処置|
|13| リハビリテーション|
|12| 点滴、注射、薬|
|10| 手術|
|19| 退院の説明|
| |（MR4） |
|5| 医師の技術や知識|
|1| 入院前の説明|
|4|医師の態度や言葉づかい|
| |（MR5） |
|2| 入院の手続き|


2因子の場合、第2因子として考えた環境設備に関する項目がMR2として一致している。
一方で、MR4やMR5の内容を見ると、5因子では解釈が難しい部分がある。

次に、3因子・4因子を比較してみる。

```{r}
#3因子
res_fa3 <- fa(data[, cols], nfactors = 3)
res_fa3 |> print(sort = TRUE)
```


```{r}
#簡易的なグラフィカルモデル
fa.diagram(res_fa3, cut = 0.3)

```



```{r}
#4因子
res_fa4 <- fa(data[, cols], nfactors = 4)
res_fa4 |> print(sort = TRUE)
```

```{r}
#簡易的なグラフィカルモデル
fa.diagram(res_fa4, cut = 0.3)

```

以下が4因子の場合の分類である。


|項目番号|内容|
|:---:|---------|
| |（MR1） |
|8| 医療スタッフのチームワーク|
|7| 日常生活の介助|
|6| 看護師の態度・言葉づかい|
|4|医師の態度や言葉づかい|
|9| 検査|
|5| 医師の技術や知識|
|3| 入院生活の説明|
| |（MR2） |
|14| 病院のトイレや浴室|
|16| 病室内の環境|
|18| 病院のその他の設備や環境|
|15| 病院の廊下や階段、エレベータ|
|17| 院中の食事|
| |（MR3） |
|11| 治療・処置|
|13| リハビリテーション|
|12| 点滴、注射、薬|
|10| 手術|
|19| 退院の説明|
| |（MR4） |
|2| 入院の手続き|
|1| 入院前の説明|


3因子の場合よりも単純構造の指数は悪いものの、解釈可能性を考慮すると4因子が妥当だと考えられる。第1因子は医療スタッフの関わり方など対人関係、第2因子は環境設備、第3因子は受ける処置について、第4因子は入院に関する説明と分けることができる。


以上で分析を終了する。


## 付録

入院患者向け患者満足度調査の質問項目

まったくそうだ（悪い・不満）を1、まったくちがう（良い・満足）を5とした5段階評価

|X（項目番号）|質問文|
|:---:|---------|
|1| 私は入院する前の医師の説明を不満に思う|
|2| 私は入院の手続きを不満に思う|
|3| 私は入院中の生活の説明を不満に思う|
|4| 私は医師の態度や言葉づかいが悪いと思う|
|5| 私は医師の技術や知識に不安を感じた|
|6| 私は看護師の態度、言葉づかい、処置のしかたを不満に思う|
|7| 私は入院中に受けた日常生活の介助を不満に思う|
|8| 私は医師や看護師など医療スタッフのチームワークが悪いと思う|
|9| 私は受けた検査に納得できない（受けた方だけお答えください）|
|10| 私は受けた手術に納得できない（受けた方だけお答えください）|
|11| 私は受けた治療・処置について納得できない（受けた方だけお答えください）|
|12| 私は受けた点滴、注射、薬に納得できない（受けた方だけお答えください）|
|13| 私は受けたリハビリテーションに納得できない（受けた方だけお答えください）|
|14| 私は病院のトイレや浴室を不満に思う|
|15| 私は病院の廊下や階段、エレベータが不便だと思う|
|16| 私は病室内の環境を不満に思う|
|17| 私は入院中の食事を不満に思う|
|18| 私は病院のその他の設備や環境を不満に思う|
|19| 私は退院の説明を不満に思う|

## 参考文献

[独立行政法人国立病院機構ホームページ](https://nho.hosp.go.jp/)

[国立病院機構評価シート](https://nho.hosp.go.jp/about/cnt1-0_000013.html)



